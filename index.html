<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Saqib Market</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase v8 (قدیمی ولی ساده و پایدار) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body style="text-align:center;font-family:sans-serif">

<h2>SAQIB MARKET</h2>

<div id="auth">
  <input id="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="Password"><br><br>
  <button onclick="register()">ثبت‌نام</button>
  <button onclick="login()">ورود</button>
</div>

<div id="chat" style="display:none">
  <h3 id="user"></h3>
  <input id="msg" placeholder="پیام">
  <button onclick="send()">ارسال</button>
  <div id="messages"></div>
  <br>
  <button onclick="logout()">خروج</button>
</div>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyAHJ_2UP6n4RyGcuWmfa1hJA_n8B1C5C2Q",
  authDomain: "saqibmarket.firebaseapp.com",
  databaseURL: "https://saqibmarket-default-rtdb.firebaseio.com",
  projectId: "saqibmarket"
};
firebase.initializeApp(firebaseConfig);

var auth = firebase.auth();
var db = firebase.database();

function register(){
  auth.createUserWithEmailAndPassword(
    email.value, password.value
  ).alert("ثبت‌نام شد");
}

function login(){
  auth.signInWithEmailAndPassword(
    email.value, password.value
  );
}

auth.onAuthStateChanged(user=>{
  if(user){
    authDiv.style.display="none";
    chat.style.display="block";
    user.innerText=user.email;
  }
});

function send(){
  db.ref("messages").push({
    user: auth.currentUser.email,
    text: msg.value
  });
  msg.value="";
}

db.ref("messages").on("child_added", s=>{
  messages.innerHTML += "<p>"+s.val().user+": "+s.val().text+"</p>";
});

function logout(){
  auth.signOut();
}
</script>

</body>
</html>
