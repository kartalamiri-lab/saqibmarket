<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>SAQIB MARKET</title>

<!-- Firebase COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
  margin:0;
  font-family:tahoma;
  background:linear-gradient(135deg,#141e30,#243b55);
  color:#fff;
  text-align:center;
}
.card{
  background:#0f172a;
  max-width:380px;
  margin:25px auto;
  padding:20px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
}
input,button{
  width:92%;
  padding:12px;
  margin:6px;
  border:none;
  border-radius:10px;
}
button{
  background:linear-gradient(45deg,#ff416c,#ff4b2b);
  color:white;
  font-weight:bold;
}
img{
  width:90px;height:90px;
  border-radius:50%;
  border:3px solid #ff4b2b;
  object-fit:cover;
}
#chatBox{display:none}
#messages{
  background:#020617;
  padding:10px;
  border-radius:10px;
  max-height:200px;
  overflow:auto;
  margin-top:10px;
  text-align:right;
}
</style>
</head>

<body>

<h2>ğŸ”¥ SAQIB MARKET ğŸ”¥</h2>

<!-- AUTH -->
<div class="card" id="auth">
  <input id="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„">
  <input id="password" type="password" placeholder="Ù¾Ø³ÙˆØ±Ø¯">
  <button onclick="register()">Ø«Ø¨Øª Ù†Ø§Ù…</button>
  <button onclick="login()">ÙˆØ±ÙˆØ¯</button>
</div>

<!-- PROFILE -->
<div class="card" id="profile" style="display:none">
  <img id="avatar">
  <input id="name" placeholder="Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ">
  <input type="file" id="photo">
  <button onclick="saveProfile()">Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
</div>

<!-- CHAT -->
<div class="card" id="chat" style="display:none">
  <h4 id="me"></h4>
  <input id="peer" placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„">
  <button onclick="startChat()">Ø´Ø±ÙˆØ¹ Ú†Øª Ø®ØµÙˆØµÛŒ</button>

  <div id="chatBox">
    <input id="msg" placeholder="Ù¾ÛŒØ§Ù…">
    <button onclick="send()">Ø§Ø±Ø³Ø§Ù„</button>
    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    <div id="messages"></div>
  </div>
</div>

<script>
// Firebase config
firebase.initializeApp({
  apiKey:"AIzaSyAHJ_2UP6n4RyGcuWmfa1hJA_n8B1C5C2Q",
  authDomain:"saqibmarket.firebaseapp.com",
  databaseURL:"https://saqibmarket-default-rtdb.firebaseio.com",
  projectId:"saqibmarket",
  storageBucket:"saqibmarket.appspot.com"
});

const auth=firebase.auth();
const db=firebase.database();
const st=firebase.storage();

let chatId=null;

// AUTH
function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(()=>alert("Ø«Ø¨Øª Ù†Ø§Ù… Ù…ÙˆÙÙ‚ âœ…"))
  .catch(e=>alert(e.message));
}
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>alert(e.message));
}

// STATE
auth.onAuthStateChanged(u=>{
  if(!u) return;

  document.getElementById("auth").style.display = "none";
  document.getElementById("profile").style.display = "block";
  document.getElementById("chat").style.display = "block";

  document.getElementById("me").innerText = u.email;

  firebase.database().ref("users/"+u.uid).once("value",s=>{
    if(s.exists()){
      document.getElementById("name").value = s.val().name || "";
      document.getElementById("avatar").src = s.val().photo || "";
    }
  });
});
   .ohSta  .ohStata  .
n o s(){Prot   cou t u=tuth.csh.cstUsen;
  i
nst oil =phot[hotlesil];
 l;f(!fiu!) return alert(ertØ³ Ø§Ù†")Ø§Ù†"Ú© 
);

  st.ref(se"(tari/"+u.uid)lidtlpit(f=>{
 ({
 ( =>{r    r.ref.gwLlowLUoadURL(urt=>{
>        db.res."eseruseri/t+u.         {
       aname:lu ,
     ,
   orl url
r  ur    });
  t   t  tuvaturl;
l;
      alert("Ù¾Ø±ÙˆÙÙ¾Ø±ÙˆÙØ°ÛŒâœ…"Ø°Ø®âœ…" âœ…
  âœ…   ; ; }  });
H)
// CHAiCfunction st(){Chat(n{t( cou t u=tuth.csh.;ntUinr;
erif(!pu(r.valuv) return alert("Ø§ÛŒÙ…ÛŒÙ„ Ø·Ø±Ù„ Ù…Ù‚Ø§Ø¨Ù†");Ù†"Ø²Ù†");t"  chat(h=btoab[u.e[ail,pulr.valtva.sert()."();("_"));B) chaycox.style.displcsp;block";
g megsaessTin=Tin="L 
";

  db.res."chatsha+sIafchafo ;();
  db.res."chatsIa+chatId).In).cn(""he=>{
 ,s=>{n=t{ const esdocument.creaceElpeElp") ");
    pei perTelrTel al();
  g
messages.aepe(ppe(l ;il}

}
fun);d(}
s ni(((
 s ni(( m  i!a!uretuetu;   .b.res("cha.sI"+chaaasI"pusa(I(.ap:s"+m+":+aa"+m+":+alu;v v=l=;v v l=;=;
}
funct;
t(
uno tu
(
 go tu
    auOut;
 nOut;
</script>

</body>
</html>
